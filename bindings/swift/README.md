# Static ETOPay SDK library for iOS using swift-bridge crate

This library provides a set of bindings for integrating the ETOPay SDK with Swift applications. It allows developers to easily use the ETOPay functionality in their Swift projects.

## Supported architectures

The library currently supports these architectures:

- `aarch64-apple-ios`: This architecture targets 64-bit ARM processors for iOS devices like iPhones and iPads.
- `aarch64-apple-darwin`: This architecture targets 64-bit ARM processors on macOS systems, enabling compatibility with Apple's hardware and software ecosystem.
- `x86_64-apple-darwin`: This architecture targets 64-bit Intel processors on macOS, facilitating development and execution of software on Apple's Intel-based Mac computers.
- `aarch64-apple-ios-sim`: This architecture targets 64-bit ARM processors running iOS simulators, typically used on Apple Silicon Macs.
- `x86_64-apple-ios`: This architecture targets 64-bit Intel processors for iOS simulators.

## Library generation

While working in dev container run a command to generate lib for one of supported architectures.

```bash
  cargo build --lib --release --target=aarch64-apple-ios
  cargo build --lib --release --target=aarch64-apple-darwin
  cargo build --lib --release --target=x86_64-apple-darwin
  cargo build --lib --release --target=aarch64-apple-ios-sim
  cargo build --lib --release --target=x86_64-apple-ios
```

To build a xcframework bundle for testing in Mac, use the following command:

```bash
make xcframework_mac
```

This command needs to be executed on a Mac with xcode tools enabled and the xcode command line tools installed. This is because this needs lipo and xcode build commands.

## Generating iOS xcframeworks

The iOS ecosystem allows developers to create xcframeworks, which are a distribution format that contains multiple architectures and platforms in a single bundle. The xcframeworks offer advantages such as improved performance, reduced app size, and easier distribution and integration.

Our xcframework structure is as following:

- ETOPaySdkBin.xcframework/
  - ios-arm64/
    - Headers/
      - generated/
        - etopay-sdk-swift/
          - etopay-sdk-swift.h
        - SwiftBridgeCore.h
      - bridging-header.h
      - module.modulemap
    - libetopaysdk_cabi.a
  - ... (other architectures)

Installing an xcframework is simply done by dragging and dropping the xcframework file in xcode or importing it using the settings menu.

## Swift package

Previously we were bundling our Swift bindings into a `.zip` file and exporting it. This was not very practical for the users and also for us since we need to bundle, download it and give it to our users manually. Instead, we want to offer it as a package. In this version we generate a Swift package instead which can be imported as a dependency. The structure of our Swift package is as following:

- ETOPaySdk/
  - ETOPaySdkBin.xcframework/
  - Sources/
    - ETOPaySdk/
      - SwiftBridgeCore.swift
      - etopay-sdk-swift.swift
      - utils.swift
  - Package.swift

The `ETOPaySdkBin.xcframework` creation and its internal structure is explained in the above `Generating iOS xcframeworks` section. The `SwiftBridgeCore.swift` and `etopay-sdk-swift.swift` files are auto-generated by the `swift-bridge` crate. Finally, the `Package.swift` is the actual file that generates the Swift package called `ETOPaySdk`.

## Running Examples

We have a `compile_swift_main` on the `Makefile` can be run as a `test` to verify that the code compiles with success. It calls the `swift.main` file which calls our Rust bindings from Swift code. On `wsl` this command will only check check for compilations errors. On `mac` it will actually call our Rust functions and output the response.

**Note**: Examples need environmental variables in order to run successfully. Make sure to add a `.env` in the root directory: `bindings/swift/examples` with the corresponding values.

```
ALICE= 
MNEMONIC_ALICE=
USERNAME=
ARCHIEVEME= 
MNEMONIC=
PASSWORD=
KC_URL=
KC_REALM=
KC_CLIENT_ID=
KC_CLIENT_SECRET=
EXAMPLE_BACKEND_URL=
```
